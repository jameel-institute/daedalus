---
title: "Getting started with DAEDALUS"
output: rmarkdown::html_vignette
bibliography: resources/references.json
link-citations: true
vignette: >
  %\VignetteIndexEntry{Getting started with DAEDALUS}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette shows how to get started with the DAEDALUS model adapted from @haw2022 in R.

```{r libraries}
# load the package
library(daedalus)
library(ggplot2)
```

The model can be run for any country or territory included in package data simply by passing its name to `daedalus()`.
The `country_names` vector holds a list of country and territory names for which data is available.

Passing the country name directly leads to the model accessing country characteristics stored as package data.
To modify country characteristics, for example to examine assumptions around changed contact patterns, users should instead create an object of the class `<daedalus_country>`, which allows setting certain country characteristics to custom values.

The class also allows users to collect country data in one place more easily.

```{r make_country}
# get default values for Canada (chosen for its short name)
daedalus_country("Canada")

# make a <daedalus_country> representing Canada
# and modify contact patterns
country_canada <- daedalus_country(
  "Canada",
  parameters = list(
    contact_matrix = matrix(5, 4, 4) # uniform contacts across age groups
  )
)

# print to examine; only some essential information is shown
country_canada
```

The package provides data from @walker2020 on country demography, country workforce per economic sector, and social contacts between age groups in `country_data`.
The package also provides data from @jarvis2024 on workplace contacts in economic sectors.
Both datasets are accessed by internal functions to reduce the need for user input.

```{r run_model}
# simulate a Covid-19 wild type outbreak, passing the <daedalus_country> object
data <- daedalus(country_canada, "sars_cov_2_pre_alpha")

# alternatively, pass the country name directly to use default country values
data <- daedalus("Canada", "sars_cov_2_pre_alpha")
```

Users can quickly model one of seven epidemics by passing a name from `daedalus::epidemic_names` to the `epidemic` argument, which is the second argument.
The package data object `daedalus::epidemic_names` gives the allowed epidemic identifiers.

```{r epidemic_names}
daedalus::epidemic_names
```

The model runs for 300 timesteps by default; timesteps should be interpreted as days since model parameters are in terms of days.
The `daedalus()` function documentation has more information on the infection parameter defaults in the **Details** section.

Users can also override epidemic-specific infection parameter values as well as change the initial conditions by passing arguments to `daedalus()` as lists: `infect_params_manual` and `initial_state_manual`, which override the infection parameters and the initial state defaults respectively.
The function documentation for `daedalus::daedalus()` details which parameters are accepted.

```r
# not run
# e.g. change the transmission rate by changing r0
daedalus(
  "United Kingdom", 
  "influenza_1918", 
  infect_params_manual = list(r0 = 1.3)
)

# e.g. change the hospitalisation risk profile to model
# 1918 Influenza epidemic but with risk of severe disease
# increasing with age
daedalus(
  "China", "influenza_1918",
  infect_params_manual = list(eta = c(2.0, 3.0, 5.0, 15.0))
)
```

Plot the data to view the epidemic curve.

```{r plot_epidemic}
ggplot(
  data[data$compartment == "infect_symp" & data$age_group == "20-65", ]
) +
  geom_line(
    aes(time, value, colour = econ_sector),
    show.legend = FALSE
  ) +
  facet_wrap(
    facets = vars(age_group)
  )
```

## References
